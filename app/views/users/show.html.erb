<div class="profile-page-layout">
  <div class="profile-info-div">
    <!-- USER INFO -->
    <% if user_signed_in? && current_user.photo.attached? %>
      <%= cl_image_tag current_user.photo.key %>
     <% end %>
    <div class="profile-info-details">
      <h1><%= @user.first_name %> <%= @user.last_name %></h1>
      <p><%= @user.email %></p>
      <p>DOB: <%= @user.date_of_birth %></p>
      <p><em><%= @user.profile %></em></p>
    </div>
  </div>
  <div class="profile-content">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">My Requests</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">My Teams</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="fourth-tab" data-toggle="tab" href="#fourth" role="tab" aria-controls="fourth" aria-selected="false">My Ringr Searches</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="fifth-tab" data-toggle="tab" href="#fifth" role="tab" aria-controls="fifth" aria-selected="false">Unsucessful requests</a>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">

<!-- MY REQUESTS TAB -->
    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
      <div class="my-requests-container">
        <div class="upcoming">
        <h2>Confirmed Games</h2>
          <div class="items">
            <% if @upcoming.empty? %>
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <h5 class="card-title">You dont have any current bookings</h5>
                  <p class="card-text">Go check out all available games to find one that works for you!</p>
                  <p><%= link_to "View all games", games_path %></p>
                </div>
              </div>
            <% end %>
            <% @upcoming.each do |booking| %>
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <h5 class="card-title"> <%= booking.game.team.name %></h5>
                  <p><%= booking.game.address %></p>
                  <p><%= booking.game.date %></p>
                  <p><%= link_to "View game details", game_path(booking.game) %></p>
                </div>
              </div>
            <% end %>
          </div>
        </div>
        <div class="Pending">
          <h2> Pending Games </h2>
          <div class="items">
            <% if @pending.empty? %>
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <h5 class="card-title">You dont have any pending requests</h5>
                  <p class="card-text">Go check out all available games to find one that works for you!</p>
                  <p><%= link_to "View all games", games_path %></p>
                </div>
              </div>
            <% end %>
            <% @pending.each do |booking| %>
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <h5 class="card-title"> <%= booking.game.team.name %></h5>
                  <p><%= booking.game.address %></p>
                  <p><%= booking.game.date %></p>
                  <p><%= link_to "View game details", game_path(booking.game) %></p>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

<!-- MY TEAMS TAB -->
    <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
      <div class="my-teams-container">
        <!-- User Teams -->
        <div class="items">
          <% current_user.teams.each do |team|%>
            <div class="card" style="width: 24rem;">
              <div class="card-body">
                <p> Upcoming games for <%= link_to team.name, team_path(team) %></p>
                <% team.games.sort_by {|game| game.time.to_i } %>
                <% team.games.each do |game| %>
                <ul><li><%= link_to game.address, game_path(game) %> </li>
                  <ul>
                    <li><%= game.date.strftime('%a %d %b') %> <%= game.time.strftime("- %I:%M%p") %></li>
                    <li>Spot available: <%= game.available_spaces %></li>
                  </ul>
                </ul>
                <% end %>
                <%= link_to "Create a new game for this team", new_team_game_path(team) %>
              </div>
            </div>
          <% end %>
      </div>
        <div class="p-3"><%= link_to "Create a new team", new_team_path, :class => "main-button" %></div>
      </div>
    </div>

<!-- RINGR SEARCH -->
    <div class="tab-pane fade" id="fourth" role="tabpanel" aria-labelledby="fourth-tab">
      <div class="ringr-search-container">
        <div class="upcoming">
          <h2>Accepted Bookings</h2>
            <div class="items">
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <% @user.requested_bookings.each do |booking| %>
                    <% if booking.status == "accepted" %>
                      <p><%= booking.user.first_name %> has been confirmed to play with <%= booking.game.team.name %> on <%= booking.game.date.strftime('%a %d %b %Y') %> <%= booking.game.time.strftime("at %I:%M%p") %></p>
                      <p>Current status: <%= booking.status %></p>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
        </div>
        <div class="requested">
          <h2>Requested Bookings</h2>
        <div class="items">
          <div class="card" style="width: 24rem;">
          <div class="card-body">
            <% @user.requested_bookings.each do |booking| %>
              <% if booking.status == "requested" %>
                <p><%= booking.user.first_name %> would like to join your team <%= booking.game.team.name %> on <%= booking.game.date.strftime('%a %d %b %Y') %> <%= booking.game.time.strftime("at %I:%M%p") %></p>
                <p>Current status: <%= booking.status %></p>
                <%= link_to "Accept", booking_path(booking, booking: {status: "accepted"}), method: :patch  %>
                <%= link_to "Reject", booking_path(booking, booking: {status: "rejected"}), method: :patch  %>
              <% end %>
            <% end %>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>

<!-- UNSUCCESSFULL BOOKING REQUEST -->
      <div class="tab-pane fade" id="fifth" role="tabpanel" aria-labelledby="fifth-tab">
        <div class="games-container">
          <div class="items">
            <% if @unsuccesful.empty? %>
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <h5 class="card-title">You haven't got any pending booking requests</h5>
                  <p class="card-text">Go check out all available games to find one that works for you!</p>
                  <p class="btn"><%= link_to "View all games", games_path %></p>
                </div>
              </div>
            <% end %>
            <% @unsuccesful.each do |booking| %>
              <div class="card" style="width: 24rem;">
                <div class="card-body">
                  <h5 class="card-title"> <%= booking.game.team.name %></h5>
                  <p class="card-text"><%= booking.game.address %></p>
                  <p class="card-text">Unfortunately your request was not accepted. Please search other games that might suit you!</p>
                  <p class="btn"><%= link_to "View all games", games_path %></p>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
